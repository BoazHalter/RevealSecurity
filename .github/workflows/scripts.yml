name: Scripts CI

on:
  push:
    branches:
      - "scripts"
jobs:
  scripts-ci-job:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Fetchfiles
        run: |
          curl "https://raw.githubusercontent.com/BoazHalter/RevealSecurity/main/.github/workflows/CI-CD.yml" >> scripts/ymlOne.yml
          curl "https://raw.githubusercontent.com/BoazHalter/RevealSecurity/dockerfile/.github/workflows/CI-CD.yml" >> scripts/ymlTwo.yml
          cat scripts/ymlOne.yml
          cat scripts/ymlTwo.yml

      - name: Run Script
        run: |
          cd scripts
          ls -la
          echo "Merging files..."
          yq eval-all --inplace 'select(fileIndex == 0) * select(fileIndex == 1)' ymlOne.yml ymlTwo.yml

          yq -n 'load(./ymlOne.yml) * load(./ymlTwo.yml)'
          echo ====
          bash run-yq.sh merge scripts/ymlOne.yml scripts/ymlTwo.yml
          bash run-yq.sh uniq scripts/ymlOne.yml scripts/ymlTwo.yml
          bash run-yq.sh common scripts/ymlOne.yml scripts/ymlTwo.yml
          bash run-yq.sh sort scripts/ymlOne.yml scripts/ymlTwo.yml
